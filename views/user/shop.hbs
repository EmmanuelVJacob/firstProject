<main>
<!--Plugin CSS file with desired skin -->
<link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.1/css/ion.rangeSlider.min.css" />

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* Add custom CSS */
        .navbar .nav-item .nav-link.active {
            border-bottom: 2px solid red;
        }
    </style>
  <!-- Hero Area Start-->
  <!-- Hero Area End-->
  <!-- Latest Products Start -->
  <section class="popular-items latest-padding">
    <div class="container">
      <div class="row product-btn justify-content-between mb-40">
         <div class="col-md-6">
                            <label for="range">Price range:</label>
                            <div class="range-slider">
                                <input type="text" id="range" class="js-range-slider" value="" />
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="extra-controls mb-4">
                                <label hidden for="selectMinPrice">Minimum price:</label>
                                <input hidden type="number" class="form-control" id="selectMinPrice" name="minPrice"
                                    value="{{minPrice}}" />

                                <label hidden for="selectMaxPrice">Maximum price:</label>
                                <input hidden type="number" class="form-control" id="selectMaxPrice" name="maxPrice"
                                    value="{{maxPrice}}" />

                                <div class="mt-5">
                                    <button class="btn btn-dark" onclick="applyFilter()">Apply</button>
                                </div>
                            </div>
                        </div>
        <div class="properties__button">
          <!--Nav Button  -->
      <nav class="navbar navbar-light ">
 <nav class="navbar navbar-expand-lg navbar-light ">
       {{#each category}}
       {{#if listed}}
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/categoryFilter/{{this.category}}">{{this.category}}</a>
                </li>
                
            </ul>
        </div>
        {{/if}}
        {{/each}}
    </nav>
   
   
</nav>

          <!--End Nav Button  -->
        </div>
        <!-- Grid and List view -->
        <div class="grid-list-view">
        </div>
        <!-- Select items -->
       
      </div>
      <!-- Nav Card -->
      <div class="tab-content" id="nav-tabContent">
         <div class="cf-left mt-3">
                                    {{!-- <select class="sort"> --}}
                                        {{!-- <option value="" >Sort by</option> --}}
                                        <a href="" class="btn btn-dark" onclick="sortPrice(1)">Low to High</a>
                                        <a href="" class="btn btn-dark" onclick="sortPrice(-1)">High to Low</a>
                                        {{!-- <option value="" onclick="sortPrice(1)">Low to High</option>
                                        <option value="" onclick="sortPrice(-1)">High to Low</option> --}}
                                    {{!-- </select> --}}
                            </div>
        <!-- card one -->
        <div
          class="tab-pane fade show active"
          id="nav-home"
          role="tabpanel"
          aria-labelledby="nav-home-tab"
        >
          <div class="row">
            {{#if productData}}
            {{#each productData}}
              <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6">
                <div class="single-popular-items mb-50 text-center">
                  <div class="popular-img mb-3">
                    <div class="w-75 p-3">
                      <a href="/product/{{this._id}}">
                        <img src="{{this.images.[0]}}" alt="" />

                      </a>

                    </div>

                    <div class="img-cap">
                      <a onclick="addToCart('{{this._id}}')">
                        <span>Add to cart</span>
                      </a>

                    </div>
                    <div class="favorit-items">
                      <span class="flaticon-heart"></span>
                    </div>
                  </div>
                  <div class="popular-caption">
                    <h3><a href="product_details.html">{{this.name}}</a></h3>
                    <span>₹ {{this.price}}</span>
                  </div>
                </div>
              </div>
            {{/each}}
            {{/if}}
            {{#if sortedProduct}}
            {{#each sortedProduct}}
              <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6">
                <div class="single-popular-items mb-50 text-center">
                  <div class="popular-img mb-3">
                    <div class="w-75 p-3">
                      <a href="/product/{{this._id}}">
                        <img src="{{this.images.[0]}}" alt="" />

                      </a>

                    </div>

                    <div class="img-cap">
                      <a onclick="addToCart('{{this._id}}')">
                        <span>Add to cart</span>
                      </a>

                    </div>
                    <div class="favorit-items">
                      <span class="flaticon-heart"></span>
                    </div>
                  </div>
                  <div class="popular-caption">
                    <h3><a href="product_details.html">{{this.name}}</a></h3>
                    <span>₹ {{this.price}}</span>
                  </div>
                </div>
              </div>
            {{/each}}
            {{/if}}
            {{#if filteredProducts}}
            {{#each filteredProducts}}
              <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6">
                <div class="single-popular-items mb-50 text-center">
                  <div class="popular-img mb-3">
                    <div class="w-75 p-3">
                      <a href="/product/{{this._id}}">
                        <img src="{{this.images.[0]}}" alt="" />

                      </a>

                    </div>

                    <div class="img-cap">
                      <a onclick="addToCart('{{this._id}}')">
                        <span>Add to cart</span>
                      </a>

                    </div>
                    <div class="favorit-items">
                      <span class="flaticon-heart"></span>
                    </div>
                  </div>
                  <div class="popular-caption">
                    <h3><a href="product_details.html">{{this.name}}</a></h3>
                    <span>₹ {{this.price}}</span>
                  </div>
                </div>
              </div>
            {{/each}}
            {{/if}}
          </div>
        </div>
<!-- Page Add Section End -->
 {{#each arr}}

  <a href="?page={{this}}">
    <button style="border-radius:40%;margin-left:3rem;color:black;">
    {{this}}
    </button>
    </a>


    {{/each}}
      <!-- End Nav Card -->
    </div>
    
   
  </section>
  <!-- Latest Products End -->
  <!--? Shop Method Start-->
  <div class="shop-method-area">
    <div class="container">
      <div class="method-wrapper">
        <div class="row d-flex justify-content-between">
          <div class="col-xl-4 col-lg-4 col-md-6">
            <div class="single-method mb-40">
              <i class="ti-package"></i>
              <h6>Free Shipping Method</h6>
              <p>aorem ixpsacdolor sit ameasecur adipisicing elitsf edasd.</p>
            </div>
          </div>
          <div class="col-xl-4 col-lg-4 col-md-6">
            <div class="single-method mb-40">
              <i class="ti-unlock"></i>
              <h6>Secure Payment System</h6>
              <p>aorem ixpsacdolor sit ameasecur adipisicing elitsf edasd.</p>
            </div>
          </div>
          <div class="col-xl-4 col-lg-4 col-md-6">
            <div class="single-method mb-40">
              <i class="ti-reload"></i>
              <h6>Secure Payment System</h6>
              <p>aorem ixpsacdolor sit ameasecur adipisicing elitsf edasd.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Shop Method End-->
</main>



<script>
  function addToCart(productId) {
    axios
      .get(`/addToCart/${productId}`)
      .then((response) => {
        if (response.status) {
          Toastify({
            text: `${response.data.message}`,
            duration: 3000,
            className: "info",
            gravity: "bottom",
            position: "center",
            style: {
              background: "linear-gradient(109.6deg, rgba(0, 0, 0, 0.93) 11.2%, rgb(63, 61, 61) 78.9%)",
            },
          }).showToast();
        }
      })
      .catch((err) => {
        Toastify({
          text: "Product is not added to cart",
          duration: 3000,
          gravity: "bottom",
          position: "center",
          backgroundColor: "linear-gradient(109.6deg, rgba(0, 0, 0, 0.93) 11.2%, rgb(63, 61, 61) 78.9%)",
          stopOnFocus: true,
          close: true,
          className: "toastify-info",
        }).showToast();
      });
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
    <script>
        // Add active class to clicked navigation item
        $(document).ready(function() {
            $(".navbar-nav .nav-link").click(function() {
                $(".navbar-nav .nav-link").removeClass("active");
                $(this).addClass("active");
            });
        });
    </script>
    
<!-- Your JavaScript code for initializing and updating the range slider Sort price -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.1/js/ion.rangeSlider.min.js"></script>
<script>
    const range = document.getElementById('range');
    const selectMinPrice = document.getElementById('selectMinPrice');
    const selectMaxPrice = document.getElementById('selectMaxPrice');

    // initialize range slider
    let instance = null;
    const min = 300;
    const max = 10000;
    const defaultMin = min;
    const defaultMax = max;
    range.value = `${defaultMin},${defaultMax}`;
    instance = $(range).ionRangeSlider({
        skin: "square",
        type: "double",
        min: min,
        max: max,
        from: defaultMin,
        to: defaultMax,
        onStart: updateInputs,
        onChange: updateInputs
    }).data("ionRangeSlider");

    function updateInputs(data) {
        selectMinPrice.value = data.from;
        selectMaxPrice.value = data.to;
    }

    function applyFilter() {
        event.preventDefault();

        console.log(`Selected price range: ${selectMinPrice.value} - ${selectMaxPrice.value}`);

        axios.post('/shopPriceFilter', {
            minPrice: selectMinPrice.value,
            maxPrice: selectMaxPrice.value,
        })
            .then(() => {
                location.href = '/shop';
            })
            .catch(() => {
                console.error('Error applying price filter')
            });
    }
</script>
<script>
  
   function sortPrice(value) {
        axios.post('/shopPriceSort', {
            minPrice: selectMinPrice.value,
            maxPrice: selectMaxPrice.value,
            sort: value
        })
            .then(() => {
                location.href = '/shop';
            })
            .catch(() => {
                location.href = '/shop';
            });
    }

</script>
  